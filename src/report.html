<html>
  <head>
    <title>ui5-test-runner report</title>
  </head>
  <body>
    <script>

function tx (content) {
  return document.createTextNode(content)
}

function el (name, attributes = {}, ...children) {
  const element = document.createElement(name)
  Object.keys(attributes).forEach(attribute => {
    element.setAttribute(attribute, attributes[attribute])
  })
  children.forEach(child => {
      if (typeof child !== 'object') {
        element.appendChild(tx(child.toString()))
      } else {
        element.appendChild(child)
      }
  })
  return element
}

async function json (url) {
  return (await fetch(url)).json()
}

json('pages.json')
  .then(pages => Object.keys(pages).forEach(page => {
    const path = pages[page]
    const details = document.body.appendChild(el('details'))
    const summary = details.appendChild(el('summary'))
    summary.appendChild(el('span', {}, page))

    json(`${path}.json`).then(report => {
      if (report.failed) {
        summary.appendChild(tx('\u274c'))
      } else {
        summary.appendChild(tx('\u2714\ufe0f'))
      }
      const table = details.appendChild(el('table', { width: '100%' }))
      table.innerHTML = `<tr>
  <th width="14%">Module</th>
  <th width="80%">Test</th>
  <th width="2%">Passed</th>
  <th width="2%">Failed</th>
  <th width="2%">Total</th>
</tr>
`
      report.tests.forEach(test => {
        table.appendChild(el('tr')).innerHTML = `
  <td>${test.module}</td>
  <td>${test.name}</td>
  <td>${test.passed}</td>
  <td>${test.failed}</td>
  <td>${test.total}</td>
`})

      details.appendChild(el('a', { href: `${path}/screenshot.png`, target: '_blank' }, 'screenshot'))
      details.appendChild(tx(' '))
      details.appendChild(el('a', { href: `${path}/console.txt`, target: '_blank' }, 'console'))
    })
  }))
        
    </script>
  </body>
</html>