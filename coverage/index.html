<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=https://ArnaudBuchholz.github.io/ui5-test-runner/coverage/ rel=canonical><link href=../testing/ rel=prev><link href=../legacy/ rel=next><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.0"><title>Coverage extraction - UI5 Test Runner</title><link rel=stylesheet href=../assets/stylesheets/main.618322db.min.css><link rel=stylesheet href=../assets/stylesheets/palette.ab4e12ef.min.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=blue data-md-color-accent=blue> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#coverage-extraction class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="UI5 Test Runner" class="md-header__button md-logo" aria-label="UI5 Test Runner" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> UI5 Test Runner </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Coverage extraction </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ArnaudBuchholz/ui5-test-runner title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> ArnaudBuchholz/ui5-test-runner </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="UI5 Test Runner" class="md-nav__button md-logo" aria-label="UI5 Test Runner" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> UI5 Test Runner </label> <div class=md-nav__source> <a href=https://github.com/ArnaudBuchholz/ui5-test-runner title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> ArnaudBuchholz/ui5-test-runner </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../usage/ class=md-nav__link> <span class=md-ellipsis> Command line usage </span> </a> </li> <li class=md-nav__item> <a href=../testing/ class=md-nav__link> <span class=md-ellipsis> Testing a "remote" application </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Coverage extraction </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Coverage extraction </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#overview class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=#how-does-it-work class=md-nav__link> <span class=md-ellipsis> How does it work ? </span> </a> </li> <li class=md-nav__item> <a href=#nycrcjson class=md-nav__link> <span class=md-ellipsis> .nycrc.json </span> </a> </li> <li class=md-nav__item> <a href=#legacy-mode class=md-nav__link> <span class=md-ellipsis> Legacy mode </span> </a> </li> <li class=md-nav__item> <a href=#remote-mode class=md-nav__link> <span class=md-ellipsis> Remote mode </span> </a> <nav class=md-nav aria-label="Remote mode"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#javascript-ui5cli-projects-ui5middleware-code-coverage class=md-nav__link> <span class=md-ellipsis> JavaScript @ui5/cli projects : @ui5/middleware-code-coverage </span> </a> </li> <li class=md-nav__item> <a href=#typescript-ui5cli-projects class=md-nav__link> <span class=md-ellipsis> TypeScript @ui5/cli projects </span> </a> <nav class=md-nav aria-label="TypeScript @ui5/cli projects"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#tweaking-ui5-tooling-transpile-in-typescript-projects class=md-nav__link> <span class=md-ellipsis> Tweaking ui5-tooling-transpile in TypeScript projects </span> </a> </li> <li class=md-nav__item> <a href=#excluding-test-code-from-coverage-reporting-in-typescript-projects class=md-nav__link> <span class=md-ellipsis> Excluding test code from coverage reporting in TypeScript projects </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#coverage-proxy-experimental class=md-nav__link> <span class=md-ellipsis> coverage-proxy (experimental) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#aggregate-coverage-for-several-projects class=md-nav__link> <span class=md-ellipsis> Aggregate coverage for several projects </span> </a> <nav class=md-nav aria-label="Aggregate coverage for several projects"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#setup class=md-nav__link> <span class=md-ellipsis> Setup </span> </a> </li> <li class=md-nav__item> <a href=#steps class=md-nav__link> <span class=md-ellipsis> Steps </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../legacy/ class=md-nav__link> <span class=md-ellipsis> Serving and testing the application (a.k.a. legacy mode) </span> </a> </li> <li class=md-nav__item> <a href=../batch/ class=md-nav__link> <span class=md-ellipsis> üÜï5.5.0 Batch mode </span> </a> </li> <li class=md-nav__item> <a href=../configuration/ class=md-nav__link> <span class=md-ellipsis> Configuration file </span> </a> </li> <li class=md-nav__item> <a href=../warnings/ class=md-nav__link> <span class=md-ellipsis> ‚ö†Ô∏è Warnings </span> </a> </li> <li class=md-nav__item> <a href=../tipsNtricks/ class=md-nav__link> <span class=md-ellipsis> Tips & tricks </span> </a> </li> <li class=md-nav__item> <a href=../demo/ class=md-nav__link> <span class=md-ellipsis> How to demo </span> </a> </li> <li class=md-nav__item> <a href=../browser/ class=md-nav__link> <span class=md-ellipsis> Browser instantiation command </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_12> <label class=md-nav__link for=__nav_12 id=__nav_12_label tabindex=0> <span class=md-ellipsis> Automation Libraries </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_12_label aria-expanded=false> <label class=md-nav__title for=__nav_12> <span class="md-nav__icon md-icon"></span> Automation Libraries </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../puppeteer/ class=md-nav__link> <span class=md-ellipsis> puppeteer </span> </a> </li> <li class=md-nav__item> <a href=../jsdom/ class=md-nav__link> <span class=md-ellipsis> jsdom </span> </a> </li> <li class=md-nav__item> <a href=../playwright/ class=md-nav__link> <span class=md-ellipsis> playwright </span> </a> </li> <li class=md-nav__item> <a href=../selenium-webdriver/ class=md-nav__link> <span class=md-ellipsis> selenium-webdriver </span> </a> </li> <li class=md-nav__item> <a href=../webdriverio/ class=md-nav__link> <span class=md-ellipsis> webdriver.io </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../mapping_v1_v2/ class=md-nav__link> <span class=md-ellipsis> Mapping v1 settings to v2 </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#overview class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=#how-does-it-work class=md-nav__link> <span class=md-ellipsis> How does it work ? </span> </a> </li> <li class=md-nav__item> <a href=#nycrcjson class=md-nav__link> <span class=md-ellipsis> .nycrc.json </span> </a> </li> <li class=md-nav__item> <a href=#legacy-mode class=md-nav__link> <span class=md-ellipsis> Legacy mode </span> </a> </li> <li class=md-nav__item> <a href=#remote-mode class=md-nav__link> <span class=md-ellipsis> Remote mode </span> </a> <nav class=md-nav aria-label="Remote mode"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#javascript-ui5cli-projects-ui5middleware-code-coverage class=md-nav__link> <span class=md-ellipsis> JavaScript @ui5/cli projects : @ui5/middleware-code-coverage </span> </a> </li> <li class=md-nav__item> <a href=#typescript-ui5cli-projects class=md-nav__link> <span class=md-ellipsis> TypeScript @ui5/cli projects </span> </a> <nav class=md-nav aria-label="TypeScript @ui5/cli projects"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#tweaking-ui5-tooling-transpile-in-typescript-projects class=md-nav__link> <span class=md-ellipsis> Tweaking ui5-tooling-transpile in TypeScript projects </span> </a> </li> <li class=md-nav__item> <a href=#excluding-test-code-from-coverage-reporting-in-typescript-projects class=md-nav__link> <span class=md-ellipsis> Excluding test code from coverage reporting in TypeScript projects </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#coverage-proxy-experimental class=md-nav__link> <span class=md-ellipsis> coverage-proxy (experimental) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#aggregate-coverage-for-several-projects class=md-nav__link> <span class=md-ellipsis> Aggregate coverage for several projects </span> </a> <nav class=md-nav aria-label="Aggregate coverage for several projects"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#setup class=md-nav__link> <span class=md-ellipsis> Setup </span> </a> </li> <li class=md-nav__item> <a href=#steps class=md-nav__link> <span class=md-ellipsis> Steps </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=coverage-extraction>Coverage extraction<a class=headerlink href=#coverage-extraction title="Permanent link">&para;</a></h1> <h2 id=overview>Overview<a class=headerlink href=#overview title="Permanent link">&para;</a></h2> <p>Tests ensure that the code <strong>behaves</strong> as expected. The code coverage checks which lines of code (function, branches...) are <strong>executed</strong> while running the tests.</p> <p>If the code coverage shows that only 10% of the code is executed during your tests it means that 90% of the code is either not tested or useless.</p> <p><strong>NOTE</strong> : having 100% code coverage does not mean that the code is fully tested !</p> <p>For instance, considering the function to test :</p> <div class="language-javascript highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=kd>function</span><span class=w> </span><span class=nx>div</span><span class=w> </span><span class=p>(</span><span class=nx>a</span><span class=p>,</span><span class=w> </span><span class=nx>b</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=nx>a</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=nx>b</span><span class=p>;</span><span class=w> </span><span class=p>}</span>
</span></code></pre></div> <p>This assertion generates 100% code coverage :</p> <div class="language-javascript highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=nx>assert</span><span class=p>.</span><span class=nx>notStrictEqual</span><span class=p>(</span><span class=nx>div</span><span class=p>(</span><span class=mf>4</span><span class=p>,</span><span class=mf>2</span><span class=p>),</span><span class=w> </span><span class=mf>0</span><span class=p>);</span>
</span></code></pre></div> <p>But, in reality, it says almost nothing on the tested code.</p> <h2 id=how-does-it-work>How does it work ?<a class=headerlink href=#how-does-it-work title="Permanent link">&para;</a></h2> <p>The following is a summary of the article <a href=https://medium.com/@arnaud-buchholz/reserve-testing-ui5-measuring-code-coverage-ef303af051ef>REserve ‚Äî Testing UI5 ‚Äî Measuring code coverage</a>.</p> <p>Three steps are required to measure code coverage : 1. <strong>Instrumentation</strong> of the code 2. <strong>Execution</strong> of the tests 3. <strong>Extraction</strong> and <strong>consolidation</strong> of code coverage</p> <p>The first step is realized with <a href=https://www.npmjs.com/package/nyc><code>nyc</code></a> which is a wrapper for <a href=https://www.npmjs.com/package/istanbul><code>istanbul</code></a>. It rewrites the code in such a way that :</p> <ul> <li>The code behavior does <strong>not</strong> change</li> <li>While the code is executed, it keeps track of which functions, lines and conditions are evaluated.</li> </ul> <p><code>ui5-test-runner</code> takes care of the second step. Based on the mode and options, it will either substitute the source files with the instrumented ones or expect the source to provide coverage information <em>(see below)</em>.</p> <p>While running, the runner extracts the code coverage information for each page (available within <code>window.top.__coverage__</code>) and stores it in the coverage temporary folder.</p> <p>When all the test pages are executed, the coverage report is generated using two commands :</p> <ul> <li><code>nyc merge</code> to merge the different coverage reports in a single one,</li> <li><code>nyc report</code> to generate the report.</li> </ul> <h2 id=nycrcjson><code>.nycrc.json</code><a class=headerlink href=#nycrcjson title="Permanent link">&para;</a></h2> <p>Coverage settings are specified through a <code>.nycrc.json</code> file, available options are described <a href="https://github.com/istanbuljs/nyc?tab=readme-ov-file#common-configuration-options">here</a>.</p> <p>The runner provides a minimal configuration file with : <div class="language-json highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=p>{</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=w>  </span><span class=nt>&quot;all&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=w>  </span><span class=nt>&quot;sourceMap&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>false</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=p>}</span>
</span></code></pre></div></p> <p>The <code>all</code> option, when set, significantly impacts the coverage report. It forces the runner to scan the project to discover all files :</p> <ul> <li>In <code>legacy</code> mode, the runner is responsible of instrumenting the sources.</li> <li>In <code>remote</code> mode, a <strong>scanner</strong> is required to discover and fetch instrumented files from the remote repository. A default scanner is provided for <code>@ui5/cli</code> served projects (<code>$/scan-ui5.js</code>).</li> </ul> <h2 id=legacy-mode>Legacy mode<a class=headerlink href=#legacy-mode title="Permanent link">&para;</a></h2> <p>In this mode, source files are directly manipulated by <code>ui5-test-runner</code>.</p> <h2 id=remote-mode>Remote mode<a class=headerlink href=#remote-mode title="Permanent link">&para;</a></h2> <p>It is possible to extract code coverage using the <code>remote</code> mode.</p> <h3 id=javascript-ui5cli-projects-ui5middleware-code-coverage>JavaScript <code>@ui5/cli</code> projects : <code>@ui5/middleware-code-coverage</code><a class=headerlink href=#javascript-ui5cli-projects-ui5middleware-code-coverage title="Permanent link">&para;</a></h3> <p>The <a href=https://www.npmjs.com/package/@ui5/middleware-code-coverage><code>@ui5/middleware-code-coverage</code></a> middleware is capable of instrumenting the source files on the fly (by adding <code>?instrument=true</code> to the URL of the file).</p> <p>According to the documentation, the coverage information can be leveraged only from UI5 1.113 thanks to <code>qunit-coverage-istanbul.js</code> which adds the URL parameter dynamically.</p> <p><code>ui5-test-runner</code> reproduces the behavior by altering the URLs without <code>qunit-coverage-istanbul.js</code> making the coverage available for <em>any</em> version.</p> <p>Here is an example of <code>ui5.yaml</code> configuration file to include the middleware.</p> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=nt>specVersion</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.0&#39;</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=nt>metadata</span><span class=p>:</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">training-ui5con18-opa</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">application</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=nt>server</span><span class=p>:</span>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=w>  </span><span class=nt>customMiddleware</span><span class=p>:</span>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;@ui5/middleware-code-coverage&quot;</span>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a><span class=w>    </span><span class=nt>afterMiddleware</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">compression</span>
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a><span class=w>    </span><span class=nt>configuration</span><span class=p>:</span>
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a><span class=w>      </span><span class=nt>instrument</span><span class=p>:</span>
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a><span class=w>        </span><span class=nt>produceSourceMap</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-3-12><a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a><span class=w>        </span><span class=nt>coverageGlobalScope</span><span class=p>:</span><span class=w> </span><span class=s>&quot;window.top&quot;</span>
</span><span id=__span-3-13><a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a><span class=w>        </span><span class=nt>coverageGlobalScopeFunc</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id=__span-3-14><a id=__codelineno-3-14 name=__codelineno-3-14 href=#__codelineno-3-14></a><span class=w>      </span><span class=nt>excludePatterns</span><span class=p>:</span>
</span><span id=__span-3-15><a id=__codelineno-3-15 name=__codelineno-3-15 href=#__codelineno-3-15></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;resources/&quot;</span>
</span></code></pre></div> <p><strong>Implementation note</strong> : unlike the expected usage of the middleware, <code>ui5-test-runner</code> generates the coverage report. It forces the runner to download all the covered source files locally to ensure the report can be generated.</p> <h3 id=typescript-ui5cli-projects>TypeScript <code>@ui5/cli</code> projects<a class=headerlink href=#typescript-ui5cli-projects title="Permanent link">&para;</a></h3> <h4 id=tweaking-ui5-tooling-transpile-in-typescript-projects>Tweaking <code>ui5-tooling-transpile</code> in TypeScript projects<a class=headerlink href=#tweaking-ui5-tooling-transpile-in-typescript-projects title="Permanent link">&para;</a></h4> <p>The <a href=https://www.npmjs.com/package/ui5-tooling-transpile><code>ui5-tooling-transpile</code></a> middleware converts TypeScript into JavaScript while serving the application. Its configuration can be tweaked to also achieve instrumentation during this step.</p> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=nt>specVersion</span><span class=p>:</span><span class=w> </span><span class=s>&quot;3.0&quot;</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=nt>server</span><span class=p>:</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=w>  </span><span class=nt>customMiddleware</span><span class=p>:</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ui5-tooling-transpile-middleware</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=w>      </span><span class=nt>afterMiddleware</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">compression</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=w>      </span><span class=nt>configuration</span><span class=p>:</span>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=w>        </span><span class=nt>debug</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a><span class=w>        </span><span class=nt>babelConfig</span><span class=p>:</span>
</span><span id=__span-4-9><a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a><span class=w>          </span><span class=nt>sourceMaps</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-4-10><a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a><span class=w>          </span><span class=nt>ignore</span><span class=p>:</span>
</span><span id=__span-4-11><a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;**/*.d.ts&quot;</span>
</span><span id=__span-4-12><a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a><span class=w>          </span><span class=nt>presets</span><span class=p>:</span>
</span><span id=__span-4-13><a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;@babel/preset-env&quot;</span>
</span><span id=__span-4-14><a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a><span class=w>            </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">defaults</span>
</span><span id=__span-4-15><a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">transform-ui5</span>
</span><span id=__span-4-16><a id=__codelineno-4-16 name=__codelineno-4-16 href=#__codelineno-4-16></a><span class=w>            </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>overridesToOverride</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-4-17><a id=__codelineno-4-17 name=__codelineno-4-17 href=#__codelineno-4-17></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;@babel/preset-typescript&quot;</span>
</span><span id=__span-4-18><a id=__codelineno-4-18 name=__codelineno-4-18 href=#__codelineno-4-18></a><span class=w>          </span><span class=nt>plugins</span><span class=p>:</span>
</span><span id=__span-4-19><a id=__codelineno-4-19 name=__codelineno-4-19 href=#__codelineno-4-19></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">istanbul</span>
</span></code></pre></div> <p>Also, add the <code>babel-plugin-istanbul</code> referenced in the last line to the project's dev dependencies: <div class="language-sh highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a>npm<span class=w> </span>i<span class=w> </span>--save-dev<span class=w> </span>babel-plugin-istanbul
</span></code></pre></div></p> <p><strong>NOTE</strong> : The <code>overridesToOverride</code> is only needed in ui5 versions &lt; 1.112.x as mentioned in the <a href="https://github.com/ui5-community/babel-plugin-transform-modules-ui5?tab=readme-ov-file#properties-related-to-controller-extensions">transform-ui5 documentation</a>.</p> <p><strong>NOTE</strong> : You may consider tweaking in a distinct configuration file and use the <code>--config</code> option to run it.</p> <p>For instance : <code>ui5 serve --config ui5-coverage.yaml</code></p> <h4 id=excluding-test-code-from-coverage-reporting-in-typescript-projects>Excluding test code from coverage reporting in TypeScript projects<a class=headerlink href=#excluding-test-code-from-coverage-reporting-in-typescript-projects title="Permanent link">&para;</a></h4> <p>To exclude the test files from coverage reporting, create a <code>.nycrc.json</code> file with the following content:</p> <div class="language-json highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=p>{</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=w>  </span><span class=nt>&quot;all&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=w>  </span><span class=nt>&quot;sourceMap&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=p>,</span>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=w>  </span><span class=nt>&quot;exclude&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=w>    </span><span class=s2>&quot;**/test/**/*.ts&quot;</span>
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=w>  </span><span class=p>]</span><span class=w>  </span>
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a><span class=p>}</span>
</span></code></pre></div> <h3 id=coverage-proxy-experimental>coverage-proxy <em>(experimental)</em><a class=headerlink href=#coverage-proxy-experimental title="Permanent link">&para;</a></h3> <p>If the remote server does not provide instrumented source files, an experimental approach consists in using <code>ui5-test-runner</code> as a 'proxy' to get the files. It will instrument the sources on the fly.</p> <p>Example : <div class="language-bash highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a>ui5-test-runner<span class=w> </span>--url<span class=w> </span>https://ui5.sap.com/test-resources/sap/m/demokit/orderbrowser/webapp/test/testsuite.qunit.html<span class=w> </span>--coverage<span class=w> </span>--coverage-proxy<span class=w> </span>--coverage-proxy-include<span class=w> </span>webapp/*<span class=w> </span>--coverage-proxy-exclude<span class=w> </span>webapp/test<span class=w> </span>--disable-ui5
</span></code></pre></div></p> <h2 id=aggregate-coverage-for-several-projects>Aggregate coverage for several projects<a class=headerlink href=#aggregate-coverage-for-several-projects title="Permanent link">&para;</a></h2> <p>It is possible to execute <code>ui5-test-runner</code> on several projects and <strong>aggregate</strong> all coverage results to generate a <strong>single</strong> report.</p> <p>There are several requirements :</p> <ul> <li> <p>Projects have a <strong>common base folder</strong> (referenced as <code>&lt;BASE_FOLDER&gt;</code>)</p> </li> <li> <p>Projects use the <strong>same language</strong> <em>(JavaScript or TypeScript)</em></p> </li> <li> <p>Coverage extraction must be done the <strong>same way</strong> <em>(legacy or remote)</em></p> </li> </ul> <h3 id=setup>Setup<a class=headerlink href=#setup title="Permanent link">&para;</a></h3> <ul> <li> <p>A folder is needed to store the merged coverage, it is referenced as <code>&lt;MERGE_COVERAGE_FOLDER&gt;</code> <em>(must be an <strong>absolute</strong> path)</em>. It must be <strong>cleared</strong> before the round of execution.</p> </li> <li> <p>A JSON configuration file is needed with the following content <em>(replace <code>&lt;BASE_FOLDER&gt;</code> with the actual value)</em>, its path is referenced as <code>&lt;NYC_CONFIG_FILE&gt;</code> <em>(must be an <strong>absolute</strong> path)</em>.</p> </li> </ul> <div class="language-json highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=p>{</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=w>    </span><span class=nt>&quot;all&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=w>    </span><span class=nt>&quot;sourceMap&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=p>,</span>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=w>    </span><span class=nt>&quot;cwd&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;&lt;BASE_FOLDER&gt;&quot;</span>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=p>}</span>
</span></code></pre></div> <blockquote> <p>Content of the configuration file</p> </blockquote> <ul> <li><a href=https://www.npmjs.com/package/nyc><code>nyc</code></a> is installed and available when running <code>npx nyc --help</code></li> </ul> <h3 id=steps>Steps<a class=headerlink href=#steps title="Permanent link">&para;</a></h3> <ul> <li>For each project (referenced as <code>&lt;PROJECT_NAME&gt;</code>) :</li> <li><code>ui5-test-runner</code> with coverage extraction</li> <li>By default, coverage information is stored in the project root under <code>.nyc_output\merged\coverage.json</code></li> <li> <p><strong>after</strong> <code>ui5-test-runner</code> successful execution, copy <code>.nyc_output\merged\coverage.json</code> to <code>&lt;MERGE_COVERAGE_FOLDER&gt;/&lt;PROJECT_NAME&gt;.json</code></p> </li> <li> <p>Once all projects are executed and coverage files copied, execute <code>npx nyc merge &lt;MERGE_COVERAGE_FOLDER&gt; &lt;MERGE_COVERAGE_FOLDER&gt;/overall/coverage.json</code></p> </li> <li> <p>Then, execute <code>npx nyc report --reporter=lcov --reporter=cobertura --temp-dir &lt;MERGE_COVERAGE_FOLDER&gt;/overall --report-dir &lt;MERGE_COVERAGE_FOLDER&gt;/coverage --nycrc-path &lt;NYC_CONFIG_FILE&gt;</code></p> </li> </ul> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"annotate": null, "base": "..", "features": ["navigation.expand", "content.code.copy"], "search": "../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../assets/javascripts/bundle.e71a0d61.min.js></script> </body> </html>